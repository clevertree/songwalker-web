import{e as R,K as U,a as M,l as S,R as j,M as H}from"./monaco-editor-DrfwNogv.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();function I(r){const e=L(r,c.__wbindgen_malloc,c.__wbindgen_realloc),n=k,t=c.compile_song(e,n);if(t[2])throw T(t[1]);return T(t[0])}function q(r,e){const n=L(r,c.__wbindgen_malloc,c.__wbindgen_realloc),t=k,s=c.render_song_samples(n,t,e);if(s[3])throw T(s[2]);var o=G(s[0],s[1]).slice();return c.__wbindgen_free(s[0],s[1]*4,4),o}function V(r,e){const n=L(r,c.__wbindgen_malloc,c.__wbindgen_realloc),t=k,s=c.render_song_wav(n,t,e);if(s[3])throw T(s[2]);var o=K(s[0],s[1]).slice();return c.__wbindgen_free(s[0],s[1]*1,1),o}function z(){return{__proto__:null,"./songwalker_core_bg.js":{__proto__:null,__wbg_Error_8c4e43fe74559d73:function(e,n){return Error(P(e,n))},__wbg_String_8f0eb39a4a4c2f66:function(e,n){const t=String(n),s=L(t,c.__wbindgen_malloc,c.__wbindgen_realloc),o=k;N().setInt32(e+4,o,!0),N().setInt32(e+0,s,!0)},__wbg___wbindgen_throw_be289d5034ed271b:function(e,n){throw new Error(P(e,n))},__wbg_new_361308b2356cecd0:function(){return new Object},__wbg_new_3eb36ae241fe6f44:function(){return new Array},__wbg_set_3f1d0b984ed272ed:function(e,n,t){e[n]=t},__wbg_set_f43e577aea94465b:function(e,n,t){e[n>>>0]=t},__wbindgen_cast_0000000000000001:function(e){return e},__wbindgen_cast_0000000000000002:function(e,n){return P(e,n)},__wbindgen_cast_0000000000000003:function(e){return BigInt.asUintN(64,e)},__wbindgen_init_externref_table:function(){const e=c.__wbindgen_externrefs,n=e.grow(4);e.set(0,void 0),e.set(n+0,void 0),e.set(n+1,null),e.set(n+2,!0),e.set(n+3,!1)}}}}function G(r,e){return r=r>>>0,Z().subarray(r/4,r/4+e)}function K(r,e){return r=r>>>0,C().subarray(r/1,r/1+e)}let y=null;function N(){return(y===null||y.buffer.detached===!0||y.buffer.detached===void 0&&y.buffer!==c.memory.buffer)&&(y=new DataView(c.memory.buffer)),y}let _=null;function Z(){return(_===null||_.byteLength===0)&&(_=new Float32Array(c.memory.buffer)),_}function P(r,e){return r=r>>>0,Q(r,e)}let v=null;function C(){return(v===null||v.byteLength===0)&&(v=new Uint8Array(c.memory.buffer)),v}function L(r,e,n){if(n===void 0){const a=B.encode(r),l=e(a.length,1)>>>0;return C().subarray(l,l+a.length).set(a),k=a.length,l}let t=r.length,s=e(t,1)>>>0;const o=C();let i=0;for(;i<t;i++){const a=r.charCodeAt(i);if(a>127)break;o[s+i]=a}if(i!==t){i!==0&&(r=r.slice(i)),s=n(s,t,t=i+r.length*3,1)>>>0;const a=C().subarray(s+i,s+t),l=B.encodeInto(r,a);i+=l.written,s=n(s,t,i,1)>>>0}return k=i,s}function T(r){const e=c.__wbindgen_externrefs.get(r);return c.__externref_table_dealloc(r),e}let E=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});E.decode();const J=2146435072;let A=0;function Q(r,e){return A+=e,A>=J&&(E=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),E.decode(),A=e),E.decode(C().subarray(r,r+e))}const B=new TextEncoder;"encodeInto"in B||(B.encodeInto=function(r,e){const n=B.encode(r);return e.set(n),{read:r.length,written:n.length}});let k=0,c;function X(r,e){return c=r.exports,y=null,_=null,v=null,c.__wbindgen_start(),c}async function Y(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(s){if(r.ok&&n(r.type)&&r.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}function n(t){switch(t){case"basic":case"cors":case"default":return!0}return!1}}async function ee(r){if(c!==void 0)return c;r!==void 0&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),r===void 0&&(r=new URL("/assets/songwalker_core_bg-2mq3pDhH.wasm",import.meta.url));const e=z();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:t}=await Y(await r,e);return X(n)}class te{ctx=null;sourceNode=null;analyser=null;gainNode=null;totalBeats=0;bpm=120;startTime=0;stateTimer=null;playing=!1;onStateChange=null;renderedSamples=null;SAMPLE_RATE=44100;constructor(){}onState(e){this.onStateChange=e}getAnalyser(){return this.analyser}get sampleRate(){return this.SAMPLE_RATE}async playSource(e){this.stop(),this.ctx||(this.ctx=new AudioContext({sampleRate:this.SAMPLE_RATE}),this.analyser=this.ctx.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.8,this.gainNode=this.ctx.createGain(),this.gainNode.connect(this.analyser),this.analyser.connect(this.ctx.destination)),this.ctx.state==="suspended"&&await this.ctx.resume();const n=q(e,this.SAMPLE_RATE);if(this.renderedSamples=n,n.length===0){this.emitState();return}this.extractMetadata(e);const t=this.ctx.createBuffer(1,n.length,this.SAMPLE_RATE);t.copyToChannel(n,0),this.sourceNode=this.ctx.createBufferSource(),this.sourceNode.buffer=t,this.sourceNode.connect(this.gainNode),this.playing=!0,this.startTime=this.ctx.currentTime,this.sourceNode.start(0),this.sourceNode.onended=()=>{this.stop()},this.stateTimer=window.setInterval(()=>this.emitState(),50),this.emitState()}stop(){if(this.sourceNode){try{this.sourceNode.stop()}catch{}this.sourceNode.disconnect(),this.sourceNode=null}this.playing=!1,this.stateTimer!==null&&(clearInterval(this.stateTimer),this.stateTimer=null),this.emitState()}exportWav(e,n="song.wav"){const t=V(e,this.SAMPLE_RATE),s=new Blob([t],{type:"audio/wav"}),o=URL.createObjectURL(s),i=document.createElement("a");i.href=o,i.download=n,i.click(),URL.revokeObjectURL(o)}getCurrentBeat(){return!this.playing||!this.ctx?0:(this.ctx.currentTime-this.startTime)*this.bpm/60}getProgress(){return!this.playing||this.totalBeats<=0?0:Math.min(this.getCurrentBeat()/this.totalBeats,1)}get isPlaying(){return this.playing}get currentBPM(){return this.bpm}get currentTotalBeats(){return this.totalBeats}extractMetadata(e){const n=e.match(/beatsPerMinute\s*=\s*(\d+)/);this.bpm=n?parseInt(n[1],10):120;try{const t=this.sourceNode?.buffer?.duration??0;this.totalBeats=t*this.bpm/60}catch{this.totalBeats=0}}emitState(){this.onStateChange&&this.onStateChange({playing:this.playing,currentBeat:this.getCurrentBeat(),totalBeats:this.totalBeats,bpm:this.bpm})}}const x="songwalker",ne={comments:{lineComment:"//"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}]},re={defaultToken:"",ignoreCase:!1,keywords:["track","const","let","await","for"],notes:["C","D","E","F","G","A","B"],drums:["Kick","Snare","HiHat","Crash","Ride","Tom","OpenHiHat","ClosedHiHat","Clap","Rimshot"],operators:["=","+","-","*","@","/",".","<",">"],symbols:/[=><!~?:&|+\-*\/\^%@.]+/,tokenizer:{root:[[/\/\/.*$/,"comment"],[/[A-G][b#]?\d+/,"variable.note"],[/\b(Kick|Snare|HiHat|Crash|Ride|Tom|OpenHiHat|ClosedHiHat|Clap|Rimshot)\b/,"variable.drum"],[/\b(track|const|let|await|for)\b/,"keyword"],[/\b(track)\.([\w.]+)/,["keyword","variable.property"]],[/[a-zA-Z_]\w*(?=\s*[\(*])/,"entity.name.function"],[/[a-zA-Z_]\w*/,"identifier"],[/\d+(\.\d+)?/,"number"],[/"([^"\\]|\\.)*"/,"string"],[/'([^'\\]|\\.)*'/,"string"],[/\/(?![\/\*])([^\/\\]|\\.)*\/[gimsuy]*/,"regexp"],[/\*/,"operator.velocity"],[/@/,"operator.duration"],[/\//,"operator.slash"],[/\.\.?/,"operator.dot"],[/[{}()\[\]]/,"@brackets"],[/[;,]/,"delimiter"]]}},se={base:"vs-dark",inherit:!0,rules:[{token:"comment",foreground:"6c7086",fontStyle:"italic"},{token:"keyword",foreground:"cba6f7",fontStyle:"bold"},{token:"variable.note",foreground:"89b4fa",fontStyle:"bold"},{token:"variable.drum",foreground:"fab387",fontStyle:"bold"},{token:"variable.property",foreground:"94e2d5"},{token:"entity.name.function",foreground:"89dceb"},{token:"number",foreground:"fab387"},{token:"string",foreground:"a6e3a1"},{token:"regexp",foreground:"f5c2e7"},{token:"operator.velocity",foreground:"f9e2af"},{token:"operator.duration",foreground:"f9e2af"},{token:"operator.slash",foreground:"6c7086"},{token:"operator.dot",foreground:"f9e2af"},{token:"identifier",foreground:"cdd6f4"},{token:"delimiter",foreground:"6c7086"}],colors:{"editor.background":"#181825","editor.foreground":"#cdd6f4","editor.lineHighlightBackground":"#1e1e2e","editor.selectionBackground":"#45475a","editorCursor.foreground":"#f5e0dc","editorLineNumber.foreground":"#585b70","editorLineNumber.activeForeground":"#a6adc8","editor.inactiveSelectionBackground":"#313244"}},oe=[{label:"track",kind:1,insertText:"track ${1:name}(${2:params}) {\n	$0\n}",insertTextRules:4,detail:"Define a new track",documentation:"Defines a track that is scheduled when called."},{label:"const",kind:1,insertText:"const ${1:name} = ${0};",insertTextRules:4,detail:"Declare a constant"},{label:"for",kind:1,insertText:"for (let ${1:i} = 0; ${1:i} < ${2:count}; ${1:i}++) {\n	$0\n}",insertTextRules:4,detail:"For loop"},{label:"loadPreset",kind:3,insertText:"await loadPreset(${0})",insertTextRules:4,detail:"Load an instrument preset (legacy)"},{label:"Oscillator",kind:3,insertText:"Oscillator({type: '${1|sine,square,sawtooth,triangle|}'})",insertTextRules:4,detail:"Create an oscillator instrument",documentation:"Built-in oscillator preset. Options: type (waveform), attack, decay, sustain, release, detune, mixer."},{label:"track.beatsPerMinute",kind:9,insertText:"track.beatsPerMinute = ${1:120};",insertTextRules:4,detail:"Set the tempo in BPM"},{label:"track.duration",kind:9,insertText:"track.duration = ${1:1/4};",insertTextRules:4,detail:"Set the default step duration (deprecated, use track.noteLength)"},{label:"track.noteLength",kind:9,insertText:"track.noteLength = ${1:1/4};",insertTextRules:4,detail:"Set the default note length"},{label:"track.instrument",kind:9,insertText:"track.instrument = ${1:inst};",insertTextRules:4,detail:"Set the track instrument"},{label:"track.effects",kind:9,insertText:"track.effects = [${0}];",insertTextRules:4,detail:"Set the track effects chain"},{label:"song.endMode",kind:9,insertText:"song.endMode = '${1|gate,release,tail|}';",insertTextRules:4,detail:"Set song end mode: 'gate', 'release', or 'tail'",documentation:"Controls output length. 'gate' = hard cut at last note-off, 'release' = wait for envelope release, 'tail' = wait for effects tail (default)."}];self.MonacoEnvironment={getWorker(r,e){return e==="json"?new Worker(new URL("/assets/json.worker-C838mOW9.js",import.meta.url),{type:"module"}):e==="css"||e==="scss"||e==="less"?new Worker(new URL("/assets/css.worker-NZNbQL3P.js",import.meta.url),{type:"module"}):e==="html"||e==="handlebars"||e==="razor"?new Worker(new URL("/assets/html.worker-eZJr__P7.js",import.meta.url),{type:"module"}):e==="typescript"||e==="javascript"?new Worker(new URL("/assets/ts.worker-BQK-3bkM.js",import.meta.url),{type:"module"}):new Worker(new URL("/assets/editor.worker-C2_AfrSl.js",import.meta.url),{type:"module"})}};const ie=`// SongWalker Example — songwalker.net
const synth = Oscillator({type: 'triangle'});
track.beatsPerMinute = 140;

riff(synth);

track riff(inst) {
    track.instrument = inst;
    track.noteLength = 1/4;

    C4 /4
    E4 /4
    G4 /4
    C5 /2

    B4 /4
    G4 /4
    E4 /4
    C4 /2

    4
}
`,D="songwalker_source";function ae(){return localStorage.getItem(D)||ie}function W(r){localStorage.setItem(D,r)}function $(){return"showOpenFilePicker"in window}async function ce(){if($())try{const[r]=await window.showOpenFilePicker({types:[{description:"SongWalker files",accept:{"text/plain":[".sw"]}}]});return await(await r.getFile()).text()}catch{return null}else return new Promise(r=>{const e=document.createElement("input");e.type="file",e.accept=".sw,.txt",e.onchange=async()=>{const n=e.files?.[0];r(n?await n.text():null)},e.click()})}async function le(r){if($())try{const n=await(await window.showSaveFilePicker({suggestedName:"song.sw",types:[{description:"SongWalker files",accept:{"text/plain":[".sw"]}}]})).createWritable();await n.write(r),await n.close()}catch{}else{const e=new Blob([r],{type:"text/plain"}),n=URL.createObjectURL(e),t=document.createElement("a");t.href=n,t.download="song.sw",t.click(),URL.revokeObjectURL(n)}}function F(r,e){const n=e.match(/\[(\d+):(\d+)\]/);if(!n)return;const t=r.getModel();if(!t)return;const s=parseInt(n[1],10),o=parseInt(n[2],10),i=t.getPositionAt(s),a=t.getPositionAt(o);R.setModelMarkers(t,"songwalker",[{severity:H.Error,message:e.replace(/\s*\[\d+:\d+\]/,""),startLineNumber:i.lineNumber,startColumn:i.column,endLineNumber:a.lineNumber,endColumn:a.column}]),r.revealPositionInCenter(i)}function O(r){const e=r.getModel();e&&R.setModelMarkers(e,"songwalker",[])}function de(){S.register({id:x,extensions:[".sw"]}),S.setLanguageConfiguration(x,ne),S.setMonarchTokensProvider(x,re),R.defineTheme("songwalker-dark",se),S.registerCompletionItemProvider(x,{provideCompletionItems(r,e){const n=r.getWordUntilPosition(e),t={startLineNumber:e.lineNumber,startColumn:n.startColumn,endLineNumber:e.lineNumber,endColumn:n.endColumn};return{suggestions:oe.map(s=>({...s,range:t}))}}})}class ue{peakBarL;peakBarR;peakValueEl;spectrumCanvas;waveformCanvas;spectrumCtx;waveformCtx;rafId=null;player;freqData=null;timeData=null;constructor(e){this.player=e,this.peakBarL=document.getElementById("peak-bar-l"),this.peakBarR=document.getElementById("peak-bar-r"),this.peakValueEl=document.getElementById("peak-value"),this.spectrumCanvas=document.getElementById("spectrum-canvas"),this.waveformCanvas=document.getElementById("waveform-canvas"),this.spectrumCtx=this.spectrumCanvas.getContext("2d"),this.waveformCtx=this.waveformCanvas.getContext("2d")}start(){this.rafId===null&&this.tick()}stop(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.peakBarL.style.height="1px",this.peakBarR.style.height="1px",this.peakBarL.className="peak-bar",this.peakBarR.className="peak-bar",this.peakValueEl.textContent="-∞ dB",this.clearCanvas(this.spectrumCtx,this.spectrumCanvas),this.clearCanvas(this.waveformCtx,this.waveformCanvas)}drawWaveformOverview(){const e=this.player.renderedSamples;if(!e||e.length===0)return;const n=this.waveformCanvas,t=this.waveformCtx,s=window.devicePixelRatio||1,o=n.getBoundingClientRect();n.width=o.width*s,n.height=o.height*s,t.scale(s,s);const i=o.width,a=o.height;t.fillStyle="#11111b",t.fillRect(0,0,i,a);const l=Math.max(1,Math.floor(e.length/i));t.beginPath(),t.strokeStyle="#89b4fa",t.lineWidth=1;const u=a/2;for(let f=0;f<i;f++){const m=f*l;let g=0,h=0;for(let p=m;p<m+l&&p<e.length;p++){const b=e[p];b<g&&(g=b),b>h&&(h=b)}t.moveTo(f,u-h*u),t.lineTo(f,u-g*u)}t.stroke(),t.strokeStyle="#313244",t.lineWidth=.5,t.beginPath(),t.moveTo(0,u),t.lineTo(i,u),t.stroke()}tick=()=>{this.rafId=requestAnimationFrame(this.tick);const e=this.player.getAnalyser();!e||!this.player.isPlaying||((!this.freqData||this.freqData.length!==e.frequencyBinCount)&&(this.freqData=new Uint8Array(e.frequencyBinCount),this.timeData=new Uint8Array(e.fftSize)),e.getByteFrequencyData(this.freqData),e.getByteTimeDomainData(this.timeData),this.drawPeak(this.timeData),this.drawSpectrum(this.freqData),this.drawPlayhead())};drawPeak(e){let n=0,t=0;for(let u=0;u<e.length;u++){const f=(e[u]-128)/128;n+=f*f;const m=Math.abs(f);m>t&&(t=m)}const s=Math.sqrt(n/e.length),o=Math.min(s*3*100,100),i=Math.min(t*100,100);this.peakBarL.style.height=`${o}%`,this.peakBarR.style.height=`${i}%`;const a=(u,f)=>{u.className=f>95?"peak-bar clip":f>70?"peak-bar hot":"peak-bar"};a(this.peakBarL,o),a(this.peakBarR,i);const l=t>0?20*Math.log10(t):-1/0;this.peakValueEl.textContent=isFinite(l)?`${l.toFixed(1)} dB`:"-∞ dB"}drawSpectrum(e){const n=this.spectrumCanvas,t=this.spectrumCtx,s=window.devicePixelRatio||1,o=n.getBoundingClientRect();(n.width!==o.width*s||n.height!==o.height*s)&&(n.width=o.width*s,n.height=o.height*s),t.setTransform(s,0,0,s,0,0);const i=o.width,a=o.height;t.fillStyle="#11111b",t.fillRect(0,0,i,a);const l=Math.min(64,e.length),u=i/l;for(let f=0;f<l;f++){const m=Math.floor(Math.pow(e.length,f/l)),g=e[Math.min(m,e.length-1)]/255,h=g*a,p=200+f/l*40;t.fillStyle=`hsl(${p}, 70%, ${50+g*30}%)`,t.fillRect(f*u+.5,a-h,u-1,h)}}drawPlayhead(){const e=this.player.renderedSamples;if(!e||e.length===0)return;const n=this.player.getProgress();if(n<=0)return;const t=this.waveformCanvas,s=this.waveformCtx,o=t.getBoundingClientRect(),i=o.width,a=o.height;this.drawWaveformOverview(),s.fillStyle="rgba(137, 180, 250, 0.08)",s.fillRect(0,0,i*n,a);const l=i*n;s.strokeStyle="#f5e0dc",s.lineWidth=1.5,s.beginPath(),s.moveTo(l,0),s.lineTo(l,a),s.stroke()}clearCanvas(e,n){const t=window.devicePixelRatio||1,s=n.getBoundingClientRect();n.width=s.width*t,n.height=s.height*t,e.setTransform(t,0,0,t,0,0),e.fillStyle="#11111b",e.fillRect(0,0,s.width,s.height)}}class fe{editor;decorations=[];events=[];player;rafId=null;constructor(e,n){this.editor=e,this.player=n}setEvents(e){this.events=(e?.events??[]).filter(n=>n.kind?.Note&&n.kind.Note.source_start!==void 0)}start(){this.rafId===null&&this.tick()}stop(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.clearDecorations()}tick=()=>{if(this.rafId=requestAnimationFrame(this.tick),!this.player.isPlaying)return;const e=this.player.getCurrentBeat(),n=this.editor.getModel();if(!n)return;const t=[];for(const s of this.events){const o=s.kind.Note,i=s.time,a=s.time+o.gate;if(e>=i&&e<a){const l=n.getPositionAt(o.source_start),u=n.getPositionAt(o.source_end);t.push({range:new j(l.lineNumber,l.column,u.lineNumber,u.column),options:{className:"note-playing",inlineClassName:"note-playing-inline"}})}}this.decorations=this.editor.deltaDecorations(this.decorations,t)};clearDecorations(){this.decorations=this.editor.deltaDecorations(this.decorations,[])}}async function he(){await ee();const r=new te;de();const e=document.createElement("style");e.textContent=`
        .note-playing {
            background-color: rgba(137, 180, 250, 0.15);
            border-radius: 2px;
        }
        .note-playing-inline {
            color: #f5e0dc !important;
            font-weight: bold;
        }
    `,document.head.appendChild(e);const n=document.getElementById("editor-container"),t=R.create(n,{value:ae(),language:x,theme:"songwalker-dark",fontSize:14,fontFamily:"'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace",lineNumbers:"on",minimap:{enabled:!1},scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:4,insertSpaces:!0,wordWrap:"off",renderWhitespace:"none",cursorBlinking:"smooth",cursorSmoothCaretAnimation:"on",smoothScrolling:!0,padding:{top:16,bottom:16},bracketPairColorization:{enabled:!0},suggest:{showKeywords:!0,showSnippets:!0}});t.onDidChangeModelContent(()=>{W(t.getValue())});const s=new ue(r),o=new fe(t,r),i=document.getElementById("play-btn"),a=document.getElementById("stop-btn"),l=document.getElementById("open-btn"),u=document.getElementById("save-btn"),f=document.getElementById("export-btn"),m=document.getElementById("fullscreen-btn"),g=document.getElementById("status"),h=document.getElementById("error");function p(){h.textContent="",O(t);try{const d=t.getValue(),w=I(d);o.setEvents(w),r.playSource(d).then(()=>{s.drawWaveformOverview(),s.start(),o.start()})}catch(d){const w=String(d);h.textContent=w,F(t,w)}}function b(){h.textContent="",O(t);try{const d=t.getValue();I(d),r.exportWav(d)}catch(d){const w=String(d);h.textContent=w,F(t,w)}}i.addEventListener("click",p),a.addEventListener("click",()=>{r.stop(),s.stop(),o.stop()}),l.addEventListener("click",async()=>{const d=await ce();d!==null&&(t.setValue(d),W(d))}),u.addEventListener("click",()=>le(t.getValue())),f.addEventListener("click",b),m.addEventListener("click",()=>{document.documentElement.classList.toggle("fullscreen"),setTimeout(()=>t.layout(),100)}),t.addAction({id:"songwalker.play",label:"Play Song",keybindings:[U.CtrlCmd|M.Enter],run:()=>p()}),t.addAction({id:"songwalker.exitFullscreen",label:"Exit Fullscreen",keybindings:[M.Escape],precondition:void 0,run:()=>{document.documentElement.classList.remove("fullscreen"),setTimeout(()=>t.layout(),100)}}),r.onState(d=>{d.playing?g.textContent=`▶ ${d.currentBeat.toFixed(1)} / ${d.totalBeats.toFixed(1)}  @${d.bpm} BPM`:(g.textContent=d.totalBeats>0?`${d.totalBeats.toFixed(1)} beats  @${d.bpm} BPM`:"Ready",s.stop(),o.stop())}),t.focus()}he().catch(console.error);
